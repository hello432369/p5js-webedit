<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8" />
    <title>p5.js edit</title>
    <script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/p5.js/1.4.1/p5.js"></script>
    <script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/ace/1.4.14/ace.js"></script>

    <style>
        .container {
            display: flex;
            height: 100vh;
            background-color: #050505;
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            overflow: hidden;
        }

        .left {
            flex: 1;
            background-color: #f2f2f2;
        }

        .right {
            flex: 1;
            position: relative;
            background-color: #e6e6e6;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 50%;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="left">
            <button id="run" onclick="runCode()"> è¿è¡Œrun</button>
            <button id="n" onclick="newCode()" style="float: right;">æ–°å»ºnew</button>
            <div id="editor" style="width: 100%; height: 100%;"> </div>
        </div>

        <div class="right">
        </div>
    </div>

    <!-- å·¦ä¾§ç¼–è¾‘å™¨ -->
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai"); //ä¸»é¢˜
        editor.getSession().setMode("ace/mode/javascript"); //è¯­è¨€
        editor.setFontSize(15); //å­—ä½“å¤§å°

        // å¯ç”¨è¯­è¨€å·¥å…·æ’ä»¶
        editor.setOptions({
            enableBasicAutocompletion: true, // å¯ç”¨åŸºæœ¬è‡ªåŠ¨å®ŒæˆåŠŸèƒ½
            enableSnippets: true, // å¯ç”¨ä»£ç æ®µåŠŸèƒ½
            enableLiveAutocompletion: true, // å¯ç”¨å®æ—¶è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ï¼ˆæ¯”å¦‚ï¼šæ™ºèƒ½ä»£ç æç¤ºï¼‰
            insertSpaces: true, // ä½¿ç”¨ç©ºæ ¼ä»£æ›¿åˆ¶è¡¨ç¬¦
            tabSize: 2 // åˆ¶è¡¨ç¬¦å¤§å°
        });
    </script>

    <!-- èœå• -->
    <script>
        //è¿è¡Œ
        function runCode() {
            if (window.p5Instance) { p5Instance.remove(); }

            window.setup = new Function(editor.getValue() + '; return setup')();
            window.draw = new Function(editor.getValue() + '; return draw')();
            window.p5Instance = new p5();
        }

        //æ–°å»º 
        function newCode() { editor.setValue('\n\nfunction preload() \n{\n\t//è¾“å…¥æ–‡ä»¶æ•°æ® \n}\n\nfunction setup()\n{\n\tcreateCanvas(300,300);\n\tbackground(123);\n\ttextSize(60);\n\ttext("å¤§å®¶å¥½ğŸ¥°",width/9,height/2);\n}\n\nfunction draw() \n{\n\t\n}'); }
    </script>

    <!-- å…³é—­æµè§ˆå™¨åï¼Œä¿ç•™æœ€åä»£ç -->
    <script>
        //ä¿å­˜åˆ°ç¼“å­˜
        window.onbeforeunload = function () {
            localStorage.setItem('editor', editor.getValue());
        };
        //è·å–ç¼“å­˜
        window.onload = function () {
            editor.setValue(localStorage.getItem('editor'));
        }
    </script>

</body>

</html>